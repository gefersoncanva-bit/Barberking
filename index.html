<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Barberking - Agendamento Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: { sans: ['Outfit', 'sans-serif'] },
            colors: {
              gold: { 400: '#fbbf24', 500: '#f59e0b', 600: '#d97706' },
              dark: { 800: '#1f2937', 900: '#111827', 950: '#030712' }
            }
          }
        }
      }
    </script>
    <style>
        body { background-color: #030712; color: #f3f4f6; }
        .glass { background: rgba(17, 24, 39, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .btn-gold { background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%); transition: all 0.3s ease; }
        .btn-gold:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(217, 119, 6, 0.4); }
    </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf-autotable.min.js"></script>
</head>
<body class="min-h-screen pb-12">

    <header class="py-8 text-center border-b border-white/5 mb-8">
        <h1 class="text-4xl font-bold tracking-tighter text-white">BARBER<span class="text-gold-500">KING</span></h1>
	<h1 class="text-lg font-bold tracking-tighter text-white">GW SERVI√áOS<span class="text-gold-500">DIGITAIS</span></h1>
        <p class="text-gray-400 mt-2 uppercase tracking-widest text-xs">Agendamento de Classe Mundial</p>
	    </header>

    <main class="max-w-4xl mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="space-y-6">
                <section class="glass p-6 rounded-2xl">
                    <h2 class="text-xl font-semibold mb-6 flex items-center gap-2 text-gold-500">1. Servi√ßo</h2>
                    <div id="services-grid" class="grid grid-cols-1 gap-3"></div>
                </section>
                <section class="glass p-6 rounded-2xl">
                    <h2 class="text-xl font-semibold mb-6 flex items-center gap-2 text-gold-500">2. Profissional</h2>
                    <div id="barbers-grid" class="grid grid-cols-2 gap-3"></div>
                </section>
                <section class="glass p-6 rounded-2xl">
                    <h2 class="text-xl font-semibold mb-6 flex items-center gap-2 text-gold-500">3. Data e Hora</h2>
                    <input type="date" id="booking-date" class="w-full bg-dark-900 border border-white/10 rounded-xl p-4 text-white focus:ring-2 focus:ring-gold-500 outline-none mb-6">
                    <div id="slots-grid" class="grid grid-cols-3 gap-2"></div>
                </section>
            </div>

            <div class="relative">
                <div class="glass p-8 rounded-2xl sticky top-8">
                    <h2 class="text-2xl font-bold mb-6 text-white text-center">Resumo</h2>
                    <div id="summary-content" class="space-y-4 mb-8"></div>
                    <div id="client-info" class="hidden space-y-4">
                        <input type="text" id="client-name" placeholder="Nome do Cliente" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-white">
                        <input type="tel" id="client-phone" placeholder="WhatsApp" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-white">
                        
                        <div class="flex items-center gap-3 p-3 bg-white/5 rounded-xl border border-white/10">
                            <input type="checkbox" id="wants-reminder" checked class="w-5 h-5 accent-gold-500">
                            <label for="wants-reminder" class="text-sm text-gray-300 cursor-pointer italic">Ativar lembrete no celular (30 min antes)</label>
                        </div>

                        <button id="btn-confirm" onclick="confirmBooking()" class="btn-gold w-full py-4 rounded-xl text-dark-950 font-bold uppercase">Confirmar Agendamento</button>
                        
                        <div id="success-area" class="hidden space-y-3">
                            <p class="text-green-400 text-center text-sm font-bold">‚úì Agendado com sucesso!</p>
                            <div id="reminder-box" class="hidden">
                                <a id="calendar-reminder" target="_blank" class="flex items-center justify-center gap-2 w-full py-3 rounded-xl bg-blue-600 text-white font-bold text-sm hover:bg-blue-700 transition-all">
                                    üîî Ativar Lembrete Agora
                                </a>
                            </div>
                            <button onclick="location.reload()" class="w-full py-2 text-xs text-gray-400 underline">Fazer outro agendamento</button>
                        </div>
                    </div>
                </div> </div> </div> </main> <div class="max-w-4xl mx-auto px-4 mt-20 border-t border-white/5 pt-12">
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <h3 class="text-gray-500 text-sm font-bold uppercase tracking-widest">Painel do Administrador</h3>

        <div class="mt-20 border-t border-white/5 pt-12">
            <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                <h3 class="text-gray-500 text-sm font-bold uppercase tracking-widest">Painel do Administrador</h3>
                
                <div id="admin-login-area" class="flex gap-2">
                    <input type="password" id="admin-pass" placeholder="Senha Admin" class="bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-sm outline-none focus:border-gold-500">
                    <button onclick="handleAdminLogin()" class="bg-gold-500 text-dark-950 px-4 py-2 rounded-lg text-sm font-bold">Acessar</button>
                </div>
                <button id="admin-logout" onclick="handleAdminLogout()" class="hidden text-red-400 text-xs font-bold uppercase border border-red-400/30 px-3 py-1 rounded-lg">Sair</button>
            </div>

            <div id="admin-content" class="hidden space-y-8">
    <section class="glass p-6 rounded-xl">
    <h3 class="text-gold-500 font-bold uppercase text-sm mb-4">Bloqueios por Per√≠odo</h3>
    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-end">
        <div>
            <label class="text-xs text-gray-400 block mb-1">Data:</label>
            <input type="date" id="off-date" class="w-full bg-white/5 border border-white/10 rounded-lg p-2 text-white outline-none focus:border-gold-500">
        </div>
        <div>
            <label class="text-xs text-gray-400 block mb-1">Profissional:</label>
            <select id="off-barber" class="w-full bg-dark-950 border border-white/10 rounded-lg p-2 text-white outline-none focus:border-gold-500">
                <option value="all">Todos</option>
                <option value="Rodrigo">Rodrigo</option>
                <option value="Junior">Junior</option>
                <option value="Afonso">Afonso</option>
            </select>
        </div>
        <div>
            <label class="text-xs text-gray-400 block mb-1">In√≠cio:</label>
            <input type="time" id="off-time-start" class="w-full bg-white/5 border border-white/10 rounded-lg p-2 text-white outline-none focus:border-gold-500">
        </div>
        <div>
            <label class="text-xs text-gray-400 block mb-1">Fim:</label>
            <input type="time" id="off-time-end" class="w-full bg-white/5 border border-white/10 rounded-lg p-2 text-white outline-none focus:border-gold-500">
        </div>
        <button onclick="addOffDate()" class="bg-gold-500 text-dark-950 px-6 py-2 rounded-lg font-bold">Bloquear Per√≠odo</button>
    </div>
    <div id="off-dates-list" class="mt-4 flex flex-wrap gap-2"></div>
</section>

    <div id="admin-appointments" class="glass overflow-hidden rounded-xl min-h-[100px]"></div>
</div>

    <script>
        const BARBERSHOP_PHONE = '5587991813113';
        const STORAGE_KEY = 'barber_appointments';
        const ADMIN_PASSWORD = 'admin123'; // <--- ALTERE SUA SENHA AQUI

        let isAdminLoggedIn = false;

        const SHOP_HOURS = {
            0: null, 1: { start: 9, end: 18 }, 2: { start: 9, end: 18 },
            3: { start: 9, end: 18 }, 4: { start: 9, end: 18 }, 
            5: { start: 9, end: 18 }, 6: { start: 8, end: 18 },
        };

        const SERVICES = [
            { id: 'corte', name: 'Corte de Cabelo', price: 35, duration: 30, icon: '‚úÇÔ∏è' },
            { id: 'barba', name: 'Barba Terapia', price: 30, duration: 30, icon: 'ü™í' },
	    { id: 'Pezinho', name: 'Acabamento/Pezinho', price: 25, duration: 30, icon: 'üìè' },
            { id: 'combo', name: 'Combo Completo', price: 50, duration: 30, icon: 'üëë' }
        ];

        const BARBERS = [
            { id: 'Rodrigo', name: 'Rodrigo', role: 'Master Barber' },
	    { id: 'Junior', name: 'Junior', role: 'Master Barber' },
            { id: 'Afonso', name: 'Afonso', role: 'Master Barber' }
        ];

        let bookingState = { serviceId: null, professionalId: null, date: '', time: null };

        // --- AUTH FUNCTIONS ---
        function handleAdminLogin() {
    const pass = document.getElementById('admin-pass').value;
    if (pass === ADMIN_PASSWORD) {
        isAdminLoggedIn = true;
        // Esconde a √°rea de login
        document.getElementById('admin-login-area').classList.add('hidden');
        // Mostra o bot√£o de sair e o conte√∫do do admin
        document.getElementById('admin-logout').classList.remove('hidden');
        document.getElementById('admin-content').classList.remove('hidden');
        
        // Renderiza a tabela e as folgas imediatamente
        renderAdminTable();
        renderOffDates();
    } else {
        alert('Senha incorreta!');
    }
}

        function handleAdminLogout() {
    isAdminLoggedIn = false;
    document.getElementById('admin-login-area').classList.remove('hidden');
    document.getElementById('admin-logout').classList.add('hidden');
    document.getElementById('admin-content').classList.add('hidden');
    document.getElementById('admin-pass').value = '';
}

        // --- CORE LOGIC ---
        function generateTimeSlots() {
    if (!bookingState.date || !bookingState.professionalId) return [];
    
    const now = new Date();
    const dateObj = new Date(bookingState.date + 'T00:00:00');
    const config = SHOP_HOURS[dateObj.getDay()];
    if (!config) return [];
    
    const offDates = getOffDates();
    const slots = [];
    let startHour = config.start;
    
    while (startHour < config.end) {
        if (startHour >= 12 && startHour < 14) { startHour++; continue; }
        const times = [`${startHour.toString().padStart(2, '0')}:00`, `${startHour.toString().padStart(2, '0')}:30`];

        times.forEach(time => {
            const isBlocked = offDates.some(block => {
                const dateMatch = block.date === bookingState.date;
                const barberMatch = block.barber === 'all' || block.barber === bookingState.professionalId;
                
                let timeMatch = false;
                if (!block.start || !block.end) {
                    timeMatch = true; // Bloqueio do dia todo
                } else {
                    // Verifica se o slot est√° dentro do intervalo
                    timeMatch = (time >= block.start && time < block.end);
                }
                return dateMatch && barberMatch && timeMatch;
            });

            if (!isBlocked) {
                const [h, m] = time.split(':').map(Number);
                const slotTime = new Date(dateObj);
                slotTime.setHours(h, m, 0, 0);
                if (slotTime > now) slots.push(time);
            }
        });
        startHour++;
    }
    return slots;
}

        function getAppointments() {
    const apps = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    const todayStr = new Date().toISOString().split('T')[0];
    
    // Filtra apenas os agendamentos de hoje em diante (limpeza autom√°tica)
    const activeApps = apps.filter(app => app.date >= todayStr);
    
    // Se algum agendamento antigo foi removido, atualiza o storage
    if (activeApps.length !== apps.length) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(activeApps));
    }
    
    return activeApps;
}

        function saveAppointment(app) {
            const apps = getAppointments();
            apps.push(app);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(apps));
        }

        function init() {
    renderServices();
    renderBarbers();
    renderOffDates(); 
    
    const dateInput = document.getElementById('booking-date');
    dateInput.min = new Date().toISOString().split('T')[0];
    
    dateInput.addEventListener('change', (e) => {
        const selectedDate = e.target.value;
        const dateObj = new Date(selectedDate + 'T00:00:00');
        const offDates = getOffDates();

        if (SHOP_HOURS[dateObj.getDay()] === null) {
            alert('Barbearia fechada neste dia.');
            e.target.value = '';
            return;
        }

        // ALTERA√á√ÉO: S√≥ bloqueia a data inteira se houver um bloqueio para "Todos" os profissionais e "Sem hor√°rio" definido
        const fullDayBlock = offDates.find(block => 
            block.date === selectedDate && block.barber === 'all' && !block.time
        );

        if (fullDayBlock) {
            alert('Aten√ß√£o: N√£o haver√° atendimento nesta data.');
            e.target.value = '';
            return;
        }

        bookingState.date = selectedDate;
        bookingState.time = null;
        renderTimeSlots();
        updateFormVisibility();
    });
}

        function renderServices() {
            document.getElementById('services-grid').innerHTML = SERVICES.map(s => `
                <button onclick="selectService('${s.id}')" id="svc-${s.id}" class="flex items-center justify-between p-4 rounded-xl border border-white/10 bg-white/5">
                    <span>${s.icon} ${s.name}</span>
                    <span class="text-gold-500 font-bold">R$ ${s.price}</span>
                </button>
            `).join('');
        }

        function renderBarbers() {
            document.getElementById('barbers-grid').innerHTML = BARBERS.map(b => `
                <button onclick="selectBarber('${b.id}')" id="brb-${b.id}" class="p-4 rounded-xl border border-white/10 bg-white/5 text-center">
                    <p class="font-semibold">${b.name}</p>
                </button>
            `).join('');
        }

        function renderTimeSlots() {
            const container = document.getElementById('slots-grid');
            const slots = generateTimeSlots();
            const apps = getAppointments();
            container.innerHTML = slots.map(time => {
                const isTaken = apps.find(a => a.date === bookingState.date && a.time === time && a.professionalId === bookingState.professionalId);
                return `<button ${isTaken ? 'disabled' : `onclick="selectTime('${time}')"`} class="p-3 rounded-lg text-sm ${isTaken ? 'opacity-20 bg-red-900' : bookingState.time === time ? 'bg-gold-500 text-black' : 'bg-white/5 border border-white/10'}">${time}</button>`;
            }).join('');
        }

        function selectService(id) { 
    bookingState.serviceId = id; 
    // Remove o destaque visual de todos os bot√µes de servi√ßo
    SERVICES.forEach(s => {
        const el = document.getElementById(`svc-${s.id}`);
        el.classList.remove('border-gold-500', 'bg-gold-500/20');
        el.classList.add('border-white/10', 'bg-white/5');
    });
    // Aplica o destaque apenas no que foi clicado
    const selected = document.getElementById(`svc-${id}`);
    selected.classList.remove('border-white/10', 'bg-white/5');
    selected.classList.add('border-gold-500', 'bg-gold-500/20');
    
    updateFormVisibility(); 
}
        function selectBarber(id) { 
    bookingState.professionalId = id; 
    // Remove o destaque visual de todos os profissionais
    BARBERS.forEach(b => {
        const el = document.getElementById(`brb-${b.id}`);
        el.classList.remove('border-gold-500', 'bg-gold-500/20');
        el.classList.add('border-white/10', 'bg-white/5');
    });
    // Aplica o destaque apenas no selecionado
    const selected = document.getElementById(`brb-${id}`);
    selected.classList.remove('border-white/10', 'bg-white/5');
    selected.classList.add('border-gold-500', 'bg-gold-500/20');
    
    renderTimeSlots(); 
    updateFormVisibility(); 
}
        function selectTime(time) { 
            bookingState.time = time; 
            renderTimeSlots(); 
            updateFormVisibility(); 
        }

        function updateFormVisibility() {
    const summary = document.getElementById('summary-content');
    if (bookingState.serviceId && bookingState.professionalId && bookingState.date && bookingState.time) {
        // Formata a data de AAAA-MM-DD para DD/MM/AAAA
        const [year, month, day] = bookingState.date.split('-');
        const dateBR = `${day}/${month}/${year}`;
        
        const serviceName = SERVICES.find(s => s.id === bookingState.serviceId).name;
        const professionalName = BARBERS.find(b => b.id === bookingState.professionalId).name;

        summary.innerHTML = `
            <div class="p-4 border border-gold-500/30 rounded-lg text-sm space-y-1 bg-white/5">
                <p class="font-bold text-gold-500 mb-2">Novo Agendamento</p>
                <p><strong>Data:</strong> ${dateBR}</p>
                <p><strong>Hora:</strong> ${bookingState.time}</p>
                <p><strong>Servi√ßo:</strong> ${serviceName}</p>
                <p><strong>Profissional:</strong> ${professionalName}</p>
            </div>`;
        document.getElementById('client-info').classList.remove('hidden');
    } else {
        summary.innerHTML = `<p class="text-gray-500 text-center italic">Aguardando sele√ß√£o...</p>`;
    }
}

function generateCalendarLink(app) {
    const serviceName = SERVICES.find(s => s.id === app.serviceId).name;
    const professionalName = BARBERS.find(b => b.id === app.professionalId).name;
    
    // Formata data e hora para o padr√£o do Google
    const datePart = app.date.replace(/-/g, '');
    const timePart = app.time.replace(':', '');
    const startDate = `${datePart}T${timePart}00`;
    
    // Calcula o fim (30 min ap√≥s o in√≠cio)
    let [h, m] = app.time.split(':').map(Number);
    m += 30;
    if(m >= 60) { h++; m -= 60; }
    const endDate = `${datePart}T${h.toString().padStart(2,'0')}${m.toString().padStart(2,'0')}00`;

    const title = encodeURIComponent(`‚è∞ LEMBRETE: BarberKing (${serviceName})`);
    const details = encodeURIComponent(
        `üìå AGENDAMENTO CONFIRMADO\n\n` +
        `‚úÇÔ∏è Servi√ßo: ${serviceName}\n` +
        `üë§ Profissional: ${professionalName}\n` +
        `üìç Local: BarberKing\n\n` +
        `üì¢ Seu celular avisar√° 30 minutos antes do hor√°rio.`
    );
    
    return `https://www.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${startDate}/${endDate}&details=${details}&sf=true&output=xml`;
}
        function confirmBooking() {
            const name = document.getElementById('client-name').value;
            const phone = document.getElementById('client-phone').value;
            const wantsReminder = document.getElementById('wants-reminder').checked;
            
            if(!name || !phone) return alert('Preencha os dados!');

            const app = { id: Date.now().toString(), ...bookingState, clientName: name, clientPhone: phone };
            saveAppointment(app);
            
            // Mostra interface de sucesso
            document.getElementById('btn-confirm').classList.add('hidden');
            document.getElementById('success-area').classList.remove('hidden');

            // S√≥ ativa o bot√£o de lembrete se o cliente quiser
            if (wantsReminder) {
                const calendarUrl = generateCalendarLink(app);
                document.getElementById('calendar-reminder').href = calendarUrl;
                document.getElementById('reminder-box').classList.remove('hidden');
            }

            const [year, month, day] = bookingState.date.split('-');
            const dateBR = `${day}/${month}/${year}`;
            const serviceName = SERVICES.find(s => s.id === bookingState.serviceId).name;
            const professionalName = BARBERS.find(b => b.id === bookingState.professionalId).name;

            const text = `*Novo Agendamento*\n` +
                         `*Nome:* ${name}\n` +
                         `*Data:* ${dateBR}\n` +
                         `*Hora:* ${bookingState.time}\n` +
                         `*Servi√ßo:* ${serviceName}\n` +
                         `*Profissional:* ${professionalName}`;

            window.open(`https://api.whatsapp.com/send?phone=${BARBERSHOP_PHONE}&text=${encodeURIComponent(text)}`, '_blank');
        }

        // --- NOVAS FUN√á√ïES DE ADMINISTRA√á√ÉO E EXPORTA√á√ÉO ---
let adminFilter = 'all'; 

function renderAdminTable() {
    if (!isAdminLoggedIn) return;
    let apps = getAppointments();
    const container = document.getElementById('admin-appointments');
    const todayStr = new Date().toISOString().split('T')[0];

    if (adminFilter === 'today') {
        apps = apps.filter(a => a.date === todayStr);
    }

    apps.sort((a, b) => (a.date + a.time).localeCompare(b.date + b.time));

    let html = `
        <div class="p-4 border-b border-white/5 flex flex-wrap gap-4 justify-between items-center bg-white/5">
            <div class="flex gap-2">
                <button onclick="setAdminFilter('all')" class="px-3 py-1 rounded-md text-xs font-bold ${adminFilter === 'all' ? 'bg-gold-500 text-dark-950' : 'bg-white/10'}">TODOS</button>
                <button onclick="setAdminFilter('today')" class="px-3 py-1 rounded-md text-xs font-bold ${adminFilter === 'today' ? 'bg-gold-500 text-dark-950' : 'bg-white/10'}">HOJE</button>
            </div>
            <div class="flex gap-2">
                <button onclick="exportToCSV()" class="text-xs text-gold-500 border border-gold-500/30 px-3 py-1 rounded-md hover:bg-gold-500 hover:text-dark-950 transition-all">CSV (EXCEL)</button>
                <button onclick="exportToPDF()" class="text-xs text-red-400 border border-red-400/30 px-3 py-1 rounded-md hover:bg-red-400 hover:text-white transition-all">PDF</button>
            </div>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full text-left text-sm">
                <thead class="bg-white/5">
                    <tr>
                        <th class="p-4">Data/Hora</th>
                        <th class="p-4">Cliente</th>
                        <th class="p-4">Servi√ßo</th>
                        <th class="p-4">Barbeiro</th>
                        <th class="p-4">A√ß√£o</th>
                    </tr>
                </thead><tbody>`;
    
    if (apps.length === 0) {
        html += `<tr><td colspan="5" class="p-8 text-center text-gray-500">Nenhum agendamento encontrado.</td></tr>`;
    } else {
        apps.forEach(app => {
            const [year, month, day] = app.date.split('-');
            const dateBR = `${day}/${month}/${year}`;
            const serviceName = SERVICES.find(s => s.id === app.serviceId)?.name || 'N/A';
            const professionalName = BARBERS.find(b => b.id === app.professionalId)?.name || 'N/A';

            html += `<tr class="border-t border-white/5">
                <td class="p-4 text-gold-500 font-mono">${dateBR} | ${app.time}</td>
                <td class="p-4 font-semibold">${app.clientName}</td>
                <td class="p-4 text-gray-400">${serviceName}</td>
                <td class="p-4 text-gray-400">${professionalName}</td>
                <td class="p-4">
                    <button onclick="handleCancel('${app.id}')" class="text-red-500 font-bold underline">CANCELAR</button>
                </td>
            </tr>`;
        });
    }
    container.innerHTML = html + `</tbody></table></div>`;
}

window.setAdminFilter = function(filter) {
    adminFilter = filter;
    renderAdminTable();
};

window.exportToCSV = function() {
    const apps = getAppointments();
    if (apps.length === 0) return alert('Sem dados.');
    let csv = 'Data;Hora;Cliente;Telefone;Servico;Profissional\n';
    apps.forEach(a => {
        const s = SERVICES.find(svc => svc.id === a.serviceId)?.name || '';
        const p = BARBERS.find(brb => brb.id === a.professionalId)?.name || '';
        csv += `${a.date};${a.time};${a.clientName};${a.clientPhone};${s};${p}\n`;
    });
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.setAttribute("download", "agendamentos_barberking.csv");
    link.click();
}; // <--- Chave de fechamento adicionada aqui

window.exportToPDF = function() {
    if (!window.jspdf) return alert('Erro: Conecte-se √† internet para carregar o gerador de PDF.');
    
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const apps = getAppointments();
    if (apps.length === 0) return alert('Sem dados.');

    const rows = apps.map(a => {
        const [y, m, d] = a.date.split('-');
        const s = SERVICES.find(svc => svc.id === a.serviceId)?.name || '';
        const p = BARBERS.find(brb => brb.id === a.professionalId)?.name || '';
        return [`${d}/${m}/${y} ${a.time}`, a.clientName, a.clientPhone, s, p];
    });

    doc.text("Relatorio BarberKing", 14, 15);
    doc.autoTable({
        head: [['Data/Hora', 'Cliente', 'WhatsApp', 'Servico', 'Profissional']],
        body: rows,
        startY: 20,
        theme: 'grid'
    });
    doc.save("agendamentos_barberking.pdf");
};

window.handleCancel = function(id) {
    if (!isAdminLoggedIn) return alert('Acesso negado!');
    if (confirm('Deseja realmente cancelar este agendamento?')) {
        const apps = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        const filtered = apps.filter(a => a.id !== id);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(filtered));
        renderAdminTable();
    }
};
const OFF_STORAGE_KEY = 'barber_off_dates';

function getOffDates() {
    return JSON.parse(localStorage.getItem(OFF_STORAGE_KEY) || '[]');
}

function addOffDate() {
    const date = document.getElementById('off-date').value;
    const barber = document.getElementById('off-barber').value;
    const start = document.getElementById('off-time-start').value;
    const end = document.getElementById('off-time-end').value;
    
    if (!date) return alert('Selecione a data!');
    
    const dates = getOffDates();
    const newBlock = { date, barber, start, end };
    
    dates.push(newBlock);
    localStorage.setItem(OFF_STORAGE_KEY, JSON.stringify(dates));
    renderOffDates();
}

function renderOffDates() {
    const container = document.getElementById('off-dates-list');
    const dates = getOffDates();
    if (dates.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-xs italic">Nenhum bloqueio ativo.</p>';
        return;
    }
    container.innerHTML = dates.map((d, index) => {
        const [y, m, day] = d.date.split('-');
        const infoBarber = d.barber === 'all' ? 'Todos' : d.barber;
        const infoPeriod = (d.start && d.end) ? ` das ${d.start} √†s ${d.end}` : ' (Dia todo)';
        return `<span class="bg-red-900/40 text-red-200 px-3 py-1 rounded-full text-xs flex items-center gap-2 border border-red-500/30">
            ${day}/${m} - ${infoBarber}${infoPeriod}
            <button onclick="removeOffDateByIndex(${index})" class="font-bold hover:text-white">√ó</button>
        </span>`;
    }).join('');
}

// Nova fun√ß√£o para remover por √≠ndice para evitar erros com objetos
window.removeOffDateByIndex = function(index) {
    const dates = getOffDates();
    dates.splice(index, 1);
    localStorage.setItem(OFF_STORAGE_KEY, JSON.stringify(dates));
    renderOffDates();
};
        init();
    </script>
</body>
</html>